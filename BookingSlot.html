<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Councillor Booking System - MindCare</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Custom styles to apply the Poppins font */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #DBF3FA; /* A calming slate color */
        }
        /* Style for the calendar grid */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }
        /* Styling for the disabled dates in the calendar */
        .day-disabled {
            color: #cbd5e1; /* Tailwind gray-300 */
            cursor: not-allowed;
            position: relative;
        }
        /* Styling for the selected date */
        .day-selected {
            background-color: #3b82f6 !important; /* Tailwind blue-500 */
            color: white !important;
            border-radius: 50%;
        }
        /* Styling for today's date */
        .day-today {
            font-weight: 700;
            border: 2px solid #60a5fa; /* Tailwind blue-400 */
            border-radius: 50%;
        }
    </style>
</head>
<body>

    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto max-w-6xl px-4 py-4 flex justify-between items-center">
            <a href="MindCareMainPage.html" class="text-2xl font-bold text-blue-600">MindCare</a>
            <a href="MindCareMainPage.html" class="bg-slate-100 text-slate-700 px-4 py-2 rounded-lg font-semibold hover:bg-slate-200 transition-colors flex items-center gap-2">
                <i class="fas fa-arrow-left fa-fw"></i>
                Back to Home
            </a>
        </div>
    </header>

    <div class="min-h-screen flex items-center justify-center p-4">
        <main class="w-full max-w-6xl bg-white rounded-2xl shadow-xl flex flex-col md:flex-row overflow-hidden my-8">

            <div class="w-full md:w-1/2 p-6 md:p-8 border-b md:border-b-0 md:border-r border-slate-200">
                <div class="flex items-center justify-between mb-6">
                    <button id="prev-month" class="p-2 rounded-full hover:bg-slate-100 transition-colors">
                        <i class="fas fa-chevron-left fa-fw text-slate-500"></i>
                    </button>
                    <h2 id="current-month-year" class="text-xl font-bold text-slate-700 text-center"></h2>
                    <button id="next-month" class="p-2 rounded-full hover:bg-slate-100 transition-colors">
                        <i class="fas fa-chevron-right fa-fw text-slate-500"></i>
                    </button>
                </div>

                <div class="calendar-grid text-sm font-medium text-center text-slate-500 mb-4">
                    <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                </div>

                <div id="calendar-days" class="calendar-grid text-center">
                    </div>
            </div>

            <div class="w-full md:w-1/2 p-6 md:p-8 flex flex-col">
                <div id="booking-form">
                    <h1 class="text-2xl font-bold text-slate-800 mb-2 flex items-center">
                        <i class="far fa-calendar-alt mr-3 text-blue-500"></i>
                        Book Your Session
                    </h1>
                    <p id="selected-date-text" class="text-slate-500 mb-6">Please select a date to see available times.</p>
                    
                    <div class="bg-blue-50 border-l-4 border-blue-400 text-blue-800 p-4 rounded-r-lg mb-6" role="alert">
                        <div class="flex">
                            <div class="py-1"><i class="fas fa-shield-alt mr-3"></i></div>
                            <div>
                                <p class="font-bold">A Safe Space for You</p>
                                <p class="text-sm">Your privacy is our priority. This is a secure and confidential space to schedule your support session.</p>
                            </div>
                        </div>
                    </div>

                    <h3 class="font-semibold text-slate-700 mb-4">Available Times</h3>
                    <div id="time-slots" class="grid grid-cols-2 sm:grid-cols-3 gap-3 mb-6 min-h-[100px]">
                        </div>

                    <div class="mt-auto">
                        <label for="topic" class="block font-semibold text-slate-700 mb-2">Topic (Optional)</label>
                        <input type="text" id="topic" placeholder="e.g., Academic Stress, Career Guidance" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-400 focus:border-blue-400 transition">
                    </div>

                    <button id="confirm-booking" class="w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-600 transition-all duration-300 mt-8 disabled:bg-slate-300 disabled:cursor-not-allowed" disabled>
                        Confirm Booking
                    </button>
                </div>

                <div id="confirmation-message" class="hidden text-center m-auto">
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check fa-3x text-green-500"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-800">Booking Confirmed!</h2>
                    <p id="confirmation-details" class="text-slate-600 mt-2"></p>
                    <button id="book-another" class="mt-8 text-blue-500 font-semibold hover:underline">Book Another Session</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const monthYearEl = document.getElementById('current-month-year');
            const calendarDaysEl = document.getElementById('calendar-days');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const selectedDateText = document.getElementById('selected-date-text');
            const timeSlotsEl = document.getElementById('time-slots');
            const confirmBookingBtn = document.getElementById('confirm-booking');
            const topicInput = document.getElementById('topic');
            const bookingForm = document.getElementById('booking-form');
            const confirmationMessage = document.getElementById('confirmation-message');
            const confirmationDetails = document.getElementById('confirmation-details');
            const bookAnotherBtn = document.getElementById('book-another');

            // App State
            let currentDate = new Date();
            let selectedDate = null;
            let selectedTime = null;

            // --- FAKE COUNCILLOR AVAILABILITY DATA ---
            const availability = {};
            
            // Dynamically generate some availability for the next 30 days
            const todayForGen = new Date();
            for (let i = 0; i < 30; i++) {
                const day = new Date(todayForGen);
                day.setDate(todayForGen.getDate() + i);
                const dayOfWeek = day.getDay(); // 0=Sun, 1=Mon, ..., 6=Sat

                // Councillor is available on weekdays (Mon-Fri)
                if (dayOfWeek > 0 && dayOfWeek < 6) {
                    const dateString = day.toISOString().split('T')[0];
                    availability[dateString] = [
                        '09:00 AM', '10:00 AM', '11:00 AM',
                        '02:00 PM', '03:00 PM', '04:00 PM'
                    ];
                }
            }

            // Function to generate and render the calendar
            const renderCalendar = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();

                monthYearEl.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;
                
                calendarDaysEl.innerHTML = ''; // Clear previous days

                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();

                // Add empty placeholders for days before the 1st of the month
                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyDiv = document.createElement('div');
                    calendarDaysEl.appendChild(emptyDiv);
                }

                // Add all days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    dayEl.textContent = day;
                    dayEl.classList.add('p-2', 'cursor-pointer', 'rounded-full', 'transition-colors', 'w-10', 'h-10', 'flex', 'items-center', 'justify-center', 'mx-auto');

                    const loopDate = new Date(year, month, day);
                    const loopDateString = loopDate.toISOString().split('T')[0];

                    // Logic to disable past dates and dates without availability
                    if (loopDate < new Date().setHours(0, 0, 0, 0) || !availability[loopDateString]) {
                        dayEl.classList.add('day-disabled');
                    } else {
                        dayEl.classList.add('hover:bg-blue-100');
                        dayEl.addEventListener('click', () => {
                            const previouslySelected = document.querySelector('.day-selected');
                            if (previouslySelected) {
                                previouslySelected.classList.remove('day-selected');
                                previouslySelected.classList.add('hover:bg-blue-100');
                            }
                            
                            dayEl.classList.add('day-selected');
                            dayEl.classList.remove('hover:bg-blue-100');
                            selectedDate = loopDate;
                            selectedTime = null; // Reset time on new date selection
                            updateBookingInfo();
                        });
                    }
                    
                    if (year === today.getFullYear() && month === today.getMonth() && day === today.getDate()) {
                        dayEl.classList.add('day-today');
                    }
                    
                    if (selectedDate && year === selectedDate.getFullYear() && month === selectedDate.getMonth() && day === selectedDate.getDate()) {
                        dayEl.classList.add('day-selected');
                        dayEl.classList.remove('hover:bg-blue-100');
                    }

                    calendarDaysEl.appendChild(dayEl);
                }
            };
            
            // Function to update the booking info panel (date and time slots)
            const updateBookingInfo = () => {
                if (selectedDate) {
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    selectedDateText.textContent = `Selected: ${selectedDate.toLocaleDateString(undefined, options)}`;
                    
                    const dateString = selectedDate.toISOString().split('T')[0];
                    const times = availability[dateString] || [];
                    
                    timeSlotsEl.innerHTML = ''; // Clear previous time slots
                    if (times.length > 0) {
                        times.forEach(time => {
                            const timeBtn = document.createElement('button');
                            timeBtn.textContent = time;
                            timeBtn.classList.add('p-2', 'border', 'rounded-lg', 'text-sm', 'transition-colors', 'duration-200');
                            if (selectedTime === time) {
                                timeBtn.classList.add('bg-blue-500', 'text-white', 'border-blue-500');
                            } else {
                                timeBtn.classList.add('border-slate-300', 'text-slate-700', 'hover:bg-slate-100');
                            }

                            timeBtn.addEventListener('click', () => {
                                selectedTime = time;
                                updateBookingInfo(); // Redraw buttons
                            });
                            timeSlotsEl.appendChild(timeBtn);
                        });
                    } else {
                        timeSlotsEl.innerHTML = '<p class="col-span-full text-slate-500 text-center">No available slots for this day.</p>';
                    }

                } else {
                    selectedDateText.textContent = 'Please select a date to see available times.';
                    timeSlotsEl.innerHTML = '<p class="col-span-full text-slate-500 text-center">Select a date first</p>';
                }
                
                confirmBookingBtn.disabled = !(selectedDate && selectedTime);
            };
            
            // Event Listeners
            prevMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
            
            confirmBookingBtn.addEventListener('click', () => {
                if (!selectedDate || !selectedTime) return;

                const topic = topicInput.value;
                const dateOptions = { weekday: 'long', month: 'long', day: 'numeric' };
                confirmationDetails.innerHTML = `Your appointment is set for <strong>${selectedDate.toLocaleDateString(undefined, dateOptions)}</strong> at <strong>${selectedTime}</strong>.`;
                if(topic){
                    confirmationDetails.innerHTML += `<br>Topic: ${topic}`;
                }

                bookingForm.classList.add('hidden');
                confirmationMessage.classList.remove('hidden');
            });
            
            bookAnotherBtn.addEventListener('click', () => {
                selectedDate = null;
                selectedTime = null;
                topicInput.value = '';
                bookingForm.classList.remove('hidden');
                confirmationMessage.classList.add('hidden');
                renderCalendar();
                updateBookingInfo();
            });

            // Initial Render
            renderCalendar();
            updateBookingInfo();
        });
    </script>
</body>
</html>